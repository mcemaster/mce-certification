<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê´€ë¦¬ì - MCE ê²½ì˜ì¸ì¦í‰ê°€ì›</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
      background: #f5f5f5;
      color: #333;
      line-height: 1.6;
      font-size: 14px;
    }
    
    /* ë¡œê·¸ì¸ í˜ì´ì§€ */
    .login-wrap {
      max-width: 400px;
      margin: 100px auto;
      padding: 20px;
    }
    
    .login-box {
      background: #fff;
      border: 2px solid #1a4b8c;
      padding: 40px 30px;
    }
    
    .login-box h1 {
      text-align: center;
      color: #1a4b8c;
      font-size: 22px;
      margin-bottom: 30px;
    }
    
    .login-box .form-group {
      margin-bottom: 15px;
    }
    
    .login-box label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
      color: #555;
    }
    
    .login-box input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    
    .login-box input:focus {
      outline: none;
      border-color: #1a4b8c;
    }
    
    .login-box button {
      width: 100%;
      padding: 14px;
      background: #1a4b8c;
      color: #fff;
      border: none;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
    }
    
    .login-box button:hover {
      background: #143a6b;
    }
    
    .login-error {
      display: none;
      background: #ffebee;
      color: #c62828;
      padding: 10px;
      margin-top: 15px;
      text-align: center;
    }
    
    .login-error.show {
      display: block;
    }
    
    /* ê´€ë¦¬ì í˜ì´ì§€ */
    .admin-wrap {
      display: none;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .admin-wrap.show {
      display: block;
    }
    
    .admin-header {
      background: #1a4b8c;
      color: #fff;
      padding: 20px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .admin-header h1 {
      font-size: 20px;
    }
    
    .btn-logout {
      background: #fff;
      color: #1a4b8c;
      border: none;
      padding: 8px 20px;
      cursor: pointer;
      font-weight: bold;
    }
    
    /* í†µê³„ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .stat-card {
      background: #fff;
      border: 1px solid #ddd;
      padding: 20px;
      text-align: center;
    }
    
    .stat-card .number {
      font-size: 32px;
      font-weight: bold;
      color: #1a4b8c;
    }
    
    .stat-card .label {
      color: #666;
      margin-top: 5px;
    }
    
    /* íƒ­ */
    .tabs {
      display: flex;
      background: #fff;
      border: 1px solid #ddd;
      border-bottom: none;
    }
    
    .tab-btn {
      flex: 1;
      padding: 15px;
      border: none;
      background: #f5f5f5;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      color: #666;
    }
    
    .tab-btn.active {
      background: #1a4b8c;
      color: #fff;
    }
    
    /* íƒ­ ì»¨í…ì¸  */
    .tab-content {
      display: none;
      background: #fff;
      border: 1px solid #ddd;
      padding: 25px;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .section-title {
      font-size: 16px;
      color: #1a4b8c;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #1a4b8c;
    }
    
    /* í¼ */
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
      color: #555;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      font-size: 14px;
      font-family: inherit;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #1a4b8c;
    }
    
    .btn-primary {
      background: #1a4b8c;
      color: #fff;
      border: none;
      padding: 12px 30px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .btn-primary:hover {
      background: #143a6b;
    }
    
    .btn-danger {
      background: #c62828;
      color: #fff;
      border: none;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 12px;
    }
    
    /* íŒŒì¼ ì—…ë¡œë“œ */
    .file-upload {
      border: 2px dashed #ccc;
      padding: 30px;
      text-align: center;
      margin-bottom: 15px;
    }
    
    .file-upload input[type="file"] {
      display: none;
    }
    
    .file-upload label {
      display: inline-block;
      padding: 12px 25px;
      background: #e3f2fd;
      color: #1a4b8c;
      cursor: pointer;
      font-weight: bold;
    }
    
    .file-upload label:hover {
      background: #bbdefb;
    }
    
    .file-info {
      margin-top: 10px;
      color: #666;
    }
    
    /* í…Œì´ë¸” */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    
    .data-table th {
      background: #f5f7fa;
      padding: 12px;
      text-align: left;
      font-weight: bold;
      border-bottom: 2px solid #ddd;
      font-size: 13px;
    }
    
    .data-table td {
      padding: 12px;
      border-bottom: 1px solid #eee;
      font-size: 13px;
    }
    
    .data-table tr:hover {
      background: #f9f9f9;
    }
    
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 3px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .badge-valid {
      background: #e8f5e9;
      color: #2e7d32;
    }
    
    .badge-expired {
      background: #ffebee;
      color: #c62828;
    }
    
    /* ë©”ì‹œì§€ */
    .message {
      padding: 12px 15px;
      margin-bottom: 15px;
      display: none;
    }
    
    .message.show {
      display: block;
    }
    
    .message.success {
      background: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #c8e6c9;
    }
    
    .message.error {
      background: #ffebee;
      color: #c62828;
      border: 1px solid #ffcdd2;
    }
    
    /* DB í…ŒìŠ¤íŠ¸ */
    .db-test-result {
      margin-top: 15px;
      padding: 15px;
      background: #f5f5f5;
      border: 1px solid #ddd;
    }
    
    /* í‘¸í„° */
    .admin-footer {
      text-align: center;
      margin-top: 30px;
      color: #888;
      font-size: 12px;
    }
    
    .admin-footer a {
      color: #1a4b8c;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <!-- ë¡œê·¸ì¸ í˜ì´ì§€ -->
  <div id="loginPage" class="login-wrap">
    <div class="login-box">
      <h1>ğŸ”’ ê´€ë¦¬ì ë¡œê·¸ì¸</h1>
      <form id="loginForm" onsubmit="doLogin(event)">
        <div class="form-group">
          <label>ì•„ì´ë””</label>
          <input type="text" id="username" placeholder="ê´€ë¦¬ì ì•„ì´ë””" required>
        </div>
        <div class="form-group">
          <label>ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
        </div>
        <button type="submit">ë¡œê·¸ì¸</button>
      </form>
      <div id="loginError" class="login-error"></div>
    </div>
  </div>
  
  <!-- ê´€ë¦¬ì í˜ì´ì§€ -->
  <div id="adminPage" class="admin-wrap">
    <div class="admin-header">
      <h1>MCE ê²½ì˜ì¸ì¦í‰ê°€ì› - ê´€ë¦¬ì</h1>
      <button class="btn-logout" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
    
    <!-- í†µê³„ -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="number" id="statTotal">0</div>
        <div class="label">ì „ì²´ ì¸ì¦</div>
      </div>
      <div class="stat-card">
        <div class="number" id="statValid">0</div>
        <div class="label">ìœ íš¨ ì¸ì¦</div>
      </div>
      <div class="stat-card">
        <div class="number" id="statExpired">0</div>
        <div class="label">ë§Œë£Œ ì¸ì¦</div>
      </div>
    </div>
    
    <!-- íƒ­ -->
    <div class="tabs">
      <button class="tab-btn active" onclick="showTab('list')">ì¸ì¦ ëª©ë¡</button>
      <button class="tab-btn" onclick="showTab('add')">ì¸ì¦ ë“±ë¡</button>
      <button class="tab-btn" onclick="showTab('bulk')">ì—‘ì…€ ì—…ë¡œë“œ</button>
      <button class="tab-btn" onclick="showTab('settings')">ì„¤ì •</button>
    </div>
    
    <!-- ì¸ì¦ ëª©ë¡ -->
    <div id="tabList" class="tab-content active">
      <h3 class="section-title">ì¸ì¦ê¸°ì—… ëª©ë¡</h3>
      <div id="listMessage" class="message"></div>
      <table class="data-table">
        <thead>
          <tr>
            <th>ê¸°ì—…ëª…</th>
            <th>ì¸ì¦ë²ˆí˜¸</th>
            <th>ì¸ì¦ê·œê²©</th>
            <th>ë§Œë£Œì¼</th>
            <th>ìƒíƒœ</th>
            <th>ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody id="certList"></tbody>
      </table>
    </div>
    
    <!-- ì¸ì¦ ë“±ë¡ -->
    <div id="tabAdd" class="tab-content">
      <h3 class="section-title">ìƒˆ ì¸ì¦ ë“±ë¡</h3>
      <div id="addMessage" class="message"></div>
      <form id="addForm" onsubmit="addCertification(event)">
        <div class="form-row">
          <div class="form-group">
            <label>ê¸°ì—…ëª… *</label>
            <input type="text" name="company_name" required>
          </div>
          <div class="form-group">
            <label>ì¸ì¦ë²ˆí˜¸ *</label>
            <input type="text" name="cert_number" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>ì¸ì¦ê·œê²© *</label>
            <select name="cert_standard" required>
              <option value="">ì„ íƒí•˜ì„¸ìš”</option>
              <option value="ISO 9001:2015">ISO 9001:2015</option>
              <option value="ISO 14001:2015">ISO 14001:2015</option>
              <option value="ISO 45001:2018">ISO 45001:2018</option>
              <option value="ISO 22000:2018">ISO 22000:2018</option>
              <option value="ISO 27001:2022">ISO 27001:2022</option>
              <option value="IATF 16949:2016">IATF 16949:2016</option>
            </select>
          </div>
          <div class="form-group">
            <label>ì¸ì¦ê¸°ê´€ *</label>
            <input type="text" name="cert_body" value="MCE ê²½ì˜ì¸ì¦í‰ê°€ì›" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>ë°œê¸‰ì¼ *</label>
            <input type="date" name="issue_date" required>
          </div>
          <div class="form-group">
            <label>ë§Œë£Œì¼ *</label>
            <input type="date" name="expiry_date" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group" style="grid-column: 1/-1;">
            <label>ì¸ì¦ë²”ìœ„ *</label>
            <textarea name="scope" rows="3" required placeholder="ì¸ì¦ë²”ìœ„ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
          </div>
        </div>
        <button type="submit" class="btn-primary">ë“±ë¡í•˜ê¸°</button>
      </form>
    </div>
    
    <!-- ì—‘ì…€ ì—…ë¡œë“œ -->
    <div id="tabBulk" class="tab-content">
      <h3 class="section-title">ì—‘ì…€ ì¼ê´„ ì—…ë¡œë“œ</h3>
      <div id="bulkMessage" class="message"></div>
      <div class="file-upload">
        <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" onchange="handleFile(this)">
        <label for="excelFile">ğŸ“ ì—‘ì…€ íŒŒì¼ ì„ íƒ</label>
        <div class="file-info" id="fileInfo">
          ì§€ì› í˜•ì‹: .xlsx, .xls, .csv<br>
          ì»¬ëŸ¼: ê¸°ì—…ëª…, ì¸ì¦ë²ˆí˜¸, ì¸ì¦ê·œê²©, ì¸ì¦ê¸°ê´€, ë°œê¸‰ì¼, ë§Œë£Œì¼, ì¸ì¦ë²”ìœ„
        </div>
      </div>
      <div id="previewArea" style="display:none;">
        <h4 style="margin-bottom:10px;">ë¯¸ë¦¬ë³´ê¸° (ì²˜ìŒ 5ê±´)</h4>
        <table class="data-table" id="previewTable">
          <thead></thead>
          <tbody></tbody>
        </table>
        <div style="margin-top:15px;">
          <button class="btn-primary" onclick="uploadBulk()">ì—…ë¡œë“œ ì‹¤í–‰</button>
        </div>
      </div>
    </div>
    
    <!-- ì„¤ì • -->
    <div id="tabSettings" class="tab-content">
      <h3 class="section-title">ì‹œìŠ¤í…œ ì„¤ì •</h3>
      <div id="settingsMessage" class="message"></div>
      
      <h4 style="margin-bottom:10px;">DB ì—°ê²° í…ŒìŠ¤íŠ¸</h4>
      <button class="btn-primary" onclick="testDb()">DB ì—°ê²° í…ŒìŠ¤íŠ¸</button>
      <div id="dbTestResult" class="db-test-result" style="display:none;"></div>
    </div>
    
    <div class="admin-footer">
      <p>&copy; 2024 MCE ê²½ì˜ì¸ì¦í‰ê°€ì›</p>
      <p style="margin-top:8px;"><a href="/">â† ê²€ìƒ‰ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a></p>
    </div>
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    var authToken = '';
    var excelData = [];
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° í™•ì¸
    window.onload = function() {
      var saved = sessionStorage.getItem('adminToken');
      if (saved) {
        authToken = saved;
        showAdmin();
      }
    };
    
    // ë¡œê·¸ì¸
    function doLogin(e) {
      e.preventDefault();
      var user = document.getElementById('username').value;
      var pass = document.getElementById('password').value;
      
      fetch('/api/admin/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({username: user, password: pass})
      })
      .then(function(r) { return r.json(); })
      .then(function(data) {
        if (data.success) {
          authToken = data.token;
          sessionStorage.setItem('adminToken', authToken);
          showAdmin();
        } else {
          showLoginError(data.error || 'ë¡œê·¸ì¸ ì‹¤íŒ¨');
        }
      })
      .catch(function() {
        showLoginError('ì„œë²„ ì—°ê²° ì˜¤ë¥˜');
      });
    }
    
    function showLoginError(msg) {
      var el = document.getElementById('loginError');
      el.textContent = msg;
      el.className = 'login-error show';
    }
    
    function doLogout() {
      authToken = '';
      sessionStorage.removeItem('adminToken');
      document.getElementById('adminPage').className = 'admin-wrap';
      document.getElementById('loginPage').style.display = 'block';
    }
    
    function showAdmin() {
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('adminPage').className = 'admin-wrap show';
      loadList();
    }
    
    // íƒ­
    function showTab(name) {
      var tabs = document.querySelectorAll('.tab-btn');
      var contents = document.querySelectorAll('.tab-content');
      
      tabs.forEach(function(t, i) {
        t.className = 'tab-btn';
      });
      contents.forEach(function(c) {
        c.className = 'tab-content';
      });
      
      document.getElementById('tab' + name.charAt(0).toUpperCase() + name.slice(1)).className = 'tab-content active';
      
      var btns = document.querySelectorAll('.tab-btn');
      var tabNames = ['list', 'add', 'bulk', 'settings'];
      var idx = tabNames.indexOf(name);
      if (idx >= 0) btns[idx].className = 'tab-btn active';
      
      if (name === 'list') loadList();
    }
    
    // ëª©ë¡ ë¡œë“œ
    function loadList() {
      fetch('/api/admin/list')
      .then(function(r) { return r.json(); })
      .then(function(data) {
        if (data.error) {
          showMessage('listMessage', data.error, 'error');
          return;
        }
        
        var list = data.results || [];
        var valid = 0, expired = 0;
        var today = new Date();
        
        var html = '';
        list.forEach(function(c) {
          var exp = new Date(c.expiry_date);
          var isExpired = exp < today;
          if (isExpired) expired++; else valid++;
          
          html += '<tr>';
          html += '<td>' + esc(c.company_name) + '</td>';
          html += '<td>' + esc(c.cert_number) + '</td>';
          html += '<td>' + esc(c.cert_standard) + '</td>';
          html += '<td>' + esc(c.expiry_date) + '</td>';
          html += '<td><span class="badge ' + (isExpired ? 'badge-expired' : 'badge-valid') + '">' + (isExpired ? 'ë§Œë£Œ' : 'ìœ íš¨') + '</span></td>';
          html += '<td><button class="btn-danger" onclick="deleteCert(' + c.id + ')">ì‚­ì œ</button></td>';
          html += '</tr>';
        });
        
        if (list.length === 0) {
          html = '<tr><td colspan="6" style="text-align:center;padding:30px;color:#888;">ë“±ë¡ëœ ì¸ì¦ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        }
        
        document.getElementById('certList').innerHTML = html;
        document.getElementById('statTotal').textContent = list.length;
        document.getElementById('statValid').textContent = valid;
        document.getElementById('statExpired').textContent = expired;
      })
      .catch(function(err) {
        showMessage('listMessage', 'ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: ' + err.message, 'error');
      });
    }
    
    // ì¸ì¦ ë“±ë¡
    function addCertification(e) {
      e.preventDefault();
      var form = e.target;
      var data = {
        company_name: form.company_name.value,
        cert_number: form.cert_number.value,
        cert_standard: form.cert_standard.value,
        cert_body: form.cert_body.value,
        issue_date: form.issue_date.value,
        expiry_date: form.expiry_date.value,
        scope: form.scope.value
      };
      
      fetch('/api/admin/create', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      })
      .then(function(r) { return r.json(); })
      .then(function(res) {
        if (res.error) {
          showMessage('addMessage', res.error, 'error');
        } else {
          showMessage('addMessage', 'ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
          form.reset();
          form.cert_body.value = 'MCE ê²½ì˜ì¸ì¦í‰ê°€ì›';
        }
      })
      .catch(function() {
        showMessage('addMessage', 'ë“±ë¡ ì‹¤íŒ¨', 'error');
      });
    }
    
    // ì‚­ì œ
    function deleteCert(id) {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      fetch('/api/admin/delete/' + id, {method: 'DELETE'})
      .then(function(r) { return r.json(); })
      .then(function(res) {
        if (res.error) {
          alert(res.error);
        } else {
          loadList();
        }
      });
    }
    
    // ì—‘ì…€ ì²˜ë¦¬
    function handleFile(input) {
      var file = input.files[0];
      if (!file) return;
      
      document.getElementById('fileInfo').textContent = 'ì„ íƒë¨: ' + file.name;
      
      var reader = new FileReader();
      reader.onload = function(e) {
        var data = new Uint8Array(e.target.result);
        var workbook = XLSX.read(data, {type: 'array'});
        var sheet = workbook.Sheets[workbook.SheetNames[0]];
        var json = XLSX.utils.sheet_to_json(sheet);
        
        excelData = json;
        showPreview(json);
      };
      reader.readAsArrayBuffer(file);
    }
    
    function showPreview(data) {
      if (data.length === 0) {
        alert('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      var preview = data.slice(0, 5);
      var keys = Object.keys(preview[0]);
      
      var thead = '<tr>';
      keys.forEach(function(k) {
        thead += '<th>' + esc(k) + '</th>';
      });
      thead += '</tr>';
      
      var tbody = '';
      preview.forEach(function(row) {
        tbody += '<tr>';
        keys.forEach(function(k) {
          tbody += '<td>' + esc(row[k] || '') + '</td>';
        });
        tbody += '</tr>';
      });
      
      document.querySelector('#previewTable thead').innerHTML = thead;
      document.querySelector('#previewTable tbody').innerHTML = tbody;
      document.getElementById('previewArea').style.display = 'block';
    }
    
    function uploadBulk() {
      if (excelData.length === 0) {
        alert('ì—…ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // ì»¬ëŸ¼ ë§¤í•‘
      var mapped = excelData.map(function(row) {
        return {
          company_name: row['ê¸°ì—…ëª…'] || row['company_name'] || '',
          cert_number: row['ì¸ì¦ë²ˆí˜¸'] || row['cert_number'] || '',
          cert_standard: row['ì¸ì¦ê·œê²©'] || row['cert_standard'] || '',
          cert_body: row['ì¸ì¦ê¸°ê´€'] || row['cert_body'] || 'MCE ê²½ì˜ì¸ì¦í‰ê°€ì›',
          issue_date: row['ë°œê¸‰ì¼'] || row['issue_date'] || '',
          expiry_date: row['ë§Œë£Œì¼'] || row['expiry_date'] || '',
          scope: row['ì¸ì¦ë²”ìœ„'] || row['scope'] || ''
        };
      });
      
      fetch('/api/admin/bulk', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({data: mapped})
      })
      .then(function(r) { return r.json(); })
      .then(function(res) {
        if (res.error) {
          showMessage('bulkMessage', res.error, 'error');
        } else {
          showMessage('bulkMessage', res.inserted + 'ê±´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
          excelData = [];
          document.getElementById('previewArea').style.display = 'none';
          document.getElementById('excelFile').value = '';
          document.getElementById('fileInfo').innerHTML = 'ì§€ì› í˜•ì‹: .xlsx, .xls, .csv<br>ì»¬ëŸ¼: ê¸°ì—…ëª…, ì¸ì¦ë²ˆí˜¸, ì¸ì¦ê·œê²©, ì¸ì¦ê¸°ê´€, ë°œê¸‰ì¼, ë§Œë£Œì¼, ì¸ì¦ë²”ìœ„';
        }
      })
      .catch(function() {
        showMessage('bulkMessage', 'ì—…ë¡œë“œ ì‹¤íŒ¨', 'error');
      });
    }
    
    // DB í…ŒìŠ¤íŠ¸
    function testDb() {
      var resultEl = document.getElementById('dbTestResult');
      resultEl.style.display = 'block';
      resultEl.innerHTML = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
      
      fetch('/api/test-db')
      .then(function(r) { return r.json(); })
      .then(function(data) {
        var html = '';
        if (data.success) {
          html = '<div style="color:#2e7d32;"><strong>âœ“ ' + data.message + '</strong></div>';
          html += '<div style="margin-top:10px;">í…Œì´ë¸” ì¡´ì¬: ' + (data.table_exists ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤') + '</div>';
          html += '<div>ë ˆì½”ë“œ ìˆ˜: ' + data.record_count + 'ê±´</div>';
        } else {
          html = '<div style="color:#c62828;"><strong>âœ— ì˜¤ë¥˜</strong></div>';
          html += '<div style="margin-top:10px;">' + esc(data.error) + '</div>';
          if (data.hint) {
            html += '<div style="margin-top:10px;color:#666;">' + esc(data.hint) + '</div>';
          }
        }
        resultEl.innerHTML = html;
      })
      .catch(function(err) {
        resultEl.innerHTML = '<div style="color:#c62828;">ì—°ê²° ì‹¤íŒ¨: ' + err.message + '</div>';
      });
    }
    
    function showMessage(id, text, type) {
      var el = document.getElementById(id);
      el.textContent = text;
      el.className = 'message show ' + type;
      setTimeout(function() {
        el.className = 'message';
      }, 5000);
    }
    
    function esc(str) {
      if (str === null || str === undefined) return '';
      var d = document.createElement('div');
      d.textContent = String(str);
      return d.innerHTML;
    }
  </script>
</body>
</html>
